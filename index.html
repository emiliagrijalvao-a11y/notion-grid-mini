<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Notion Grid Widget</title>
    <style>/* === Grace theme === */
:root{
  --cols: 3;          /* # de columnas (lo podr√°s cambiar por URL) */
  --gap: 14px;        /* separaci√≥n */
  --radius: 16px;     /* bordes de la tarjeta */
}

/* rejilla controlada por variables */
.grid{
  display:grid;
  grid-template-columns: repeat(var(--cols), 1fr);
  gap: var(--gap);
}

/* tarjeta con bordes suaves y hover sutil */
.card{
  position: relative;
  background: #111319;
  border: 1px solid #262833;
  border-radius: var(--radius);
  overflow: hidden;
  transition: transform .2s ease, border-color .2s ease;
}
.card:hover{
  transform: translateY(-2px);
  border-color: #6b7cff55;
}

/* imagen cuadrada tipo ‚Äúfeed‚Äù, ligero zoom al hover */
.thumb{
  width:100%;
  aspect-ratio: 1 / 1;
  object-fit: cover;
  display:block;
  transition: transform .4s ease;
}
.card:hover .thumb{ transform: scale(1.03); }

/* t√≠tulo sobrepuesto con degradado oscuro */
.info{
  position: absolute;
  left:0; right:0; bottom:0;
  padding: 14px 16px;
  background: linear-gradient(to top, rgba(0,0,0,.65), rgba(0,0,0,0));
  border-top: 1px solid rgba(255,255,255,.06);
}
.card-title{
  color:#fff;
  font-size:14px;
  font-weight:600;
  line-height:1.3;
  text-shadow: 0 1px 2px rgba(0,0,0,.35);
}

/* ocultamos el link de texto (ya abre al clickear la tarjeta) */
.link{ display:none; }

/* Modo embed: ocultar cabecera y pie para Notion */
body.embed .header, body.embed .footer{ display:none; }
body.embed .wrap{ padding-top: 8px; }
      :root { --gap:16px; --card:12px; --bg:#0b0b0c; --panel:#1a1a1f; --text:#f3f3f3; --muted:#a0a0aa; --border:#2a2a32; --accent:#8ab4ff; }
      *{margin:0;padding:0;box-sizing:border-box}
      html,body{background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Inter',sans-serif;line-height:1.5}
      .wrap{max-width:1200px;margin:0 auto;padding:32px 20px}
      .header{text-align:center;margin-bottom:40px}
      h1{font-size:32px;font-weight:700;margin-bottom:8px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
      .subtitle{color:var(--muted);font-size:16px}
      .state{color:var(--muted);font-size:14px;padding:12px;text-align:center;margin-bottom:20px}
      .state.loading{animation:pulse 1.5s ease-in-out infinite}
      @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
      .state.error{color:#ffb3b3;background:rgba(255,179,179,.1);border:1px solid rgba(255,179,179,.3);border-radius:8px}
      .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:var(--gap);margin-bottom:32px}
      @media (max-width:900px){.grid{grid-template-columns:repeat(2,1fr)}}
      @media (max-width:600px){.grid{grid-template-columns:1fr}.wrap{padding:20px 16px}h1{font-size:24px}}
      .card{background:var(--panel);border-radius:var(--card);overflow:hidden;border:1px solid var(--border);transition:all .3s ease;cursor:pointer}
      .card:hover{transform:translateY(-4px);box-shadow:0 8px 24px rgba(0,0,0,.4);border-color:var(--accent)}
      .thumb{width:100%;height:280px;object-fit:cover;display:block;background:linear-gradient(135deg,#2a2a32 0%,#1a1a1f 100%)}
      .thumb.placeholder{display:flex;align-items:center;justify-content:center;font-size:48px;color:var(--muted)}
      .info{padding:16px}
      .card-title{font-size:15px;font-weight:600;margin-bottom:8px;color:var(--text);line-height:1.4}
      .link{color:var(--accent);text-decoration:none;font-size:13px;display:inline-flex;align-items:center;gap:4px;transition:opacity .2s}
      .link:hover{opacity:.7}
      .footer{text-align:center;margin-top:48px;padding-top:24px;border-top:1px solid var(--border);color:var(--muted);font-size:13px}
      .footer a{color:var(--accent);text-decoration:none}
      .footer a:hover{text-decoration:underline}
      .empty-state{text-align:center;padding:60px 20px;grid-column:1 / -1}
      .empty-state-icon{font-size:64px;margin-bottom:16px;opacity:.5}
      .empty-state-text{color:var(--muted);font-size:18px}
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="header">
        <h1>üì∏ Notion Grid Widget</h1>
        <p class="subtitle">Tu contenido de Notion en un grid hermoso</p>
      </div>

      <div id="state" class="state loading">Cargando posts...</div>
      <div id="grid" class="grid"></div>

      <div class="footer">
        Powered by <a href="https://notion.so" target="_blank">Notion</a> +
        <a href="https://vercel.com" target="_blank">Vercel</a>
      </div>
    </div>

    <script>
      async function loadGrid() {
        const stateEl = document.getElementById("state");
        const gridEl = document.getElementById("grid");
        try {
          const response = await fetch("/api/grid");
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          const data = await response.json();
          const items = data.items || [];
          stateEl.style.display = "none";
          if (items.length === 0) {
            gridEl.innerHTML = `
              <div class="empty-state">
                <div class="empty-state-icon">üì≠</div>
                <div class="empty-state-text">No hay posts todav√≠a</div>
              </div>`;
            return;
          }
          gridEl.innerHTML = items.map(item => {
            const title = (item.title || "Sin t√≠tulo").replace(/</g,"&lt;").replace(/>/g,"&gt;");
            const imageHtml = item.image
              ? `<img class="thumb" src="${item.image}" alt="${title}" loading="lazy">`
              : `<div class="thumb placeholder">üñºÔ∏è</div>`;
            const linkHtml = item.link
              ? `<a class="link" href="${item.link}" target="_blank" rel="noopener noreferrer">Abrir enlace ‚Üí</a>`
              : "";
            const click = item.link ? `onclick="window.open('${item.link}','_blank')"` : "";
            return `<div class="card" ${click}>${imageHtml}<div class="info"><div class="card-title">${title}</div>${linkHtml}</div></div>`;
          }).join("");
        } catch (e) {
          stateEl.className = "state error";
          stateEl.textContent = `‚ùå Error al cargar: ${e.message}. Verifica /api/health y las variables de entorno.`;
          stateEl.style.display = "block";
        }
      }
      loadGrid();
      setInterval(loadGrid, 5 * 60 * 1000);
    </script>
  </body>
</html>
