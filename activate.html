<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Activar tu Notion Grid</title>
<style>
  body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:0;background:#fff;color:#111}
  .wrap{max-width:720px;margin:0 auto;padding:24px}
  .card{border:1px solid #e5e7eb;border-radius:12px;padding:16px}
  label{display:block;font-weight:600;margin:10px 0 6px}
  input{width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:10px}
  button{margin-top:14px;padding:10px 14px;border:0;border-radius:10px;background:#111;color:#fff;font-weight:700;cursor:pointer}
  .out{margin-top:16px;padding:12px;background:#f9fafb;border-radius:8px;word-break:break-all}
</style>
</head>
<body>
  <main class="wrap">
    <h1>Activar tu Notion Grid</h1>
    <p>Completa estos datos para generar tu link de widget.</p>
    <div class="card">
      <label>Email</label>
      <input id="email" placeholder="tu@email.com">

      <label>License</label>
      <input id="license" placeholder="pega aquí tu licencia">

      <label>Notion Integration Secret</label>
      <input id="secret" placeholder="secret_...">

      <label>Database ID (Grid)</label>
      <input id="db" placeholder="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">

      <label>Bio Settings DB ID (opcional)</label>
      <input id="bio">

      <button id="go">Generar Widget</button>
      <div id="msg" class="out" style="display:none"></div>
    </div>
  </main>
<script>
const qs=new URLSearchParams(location.search);
document.getElementById('email').value = qs.get('email')||"";
document.getElementById('license').value = qs.get('license')||"";

document.getElementById('go').onclick=async()=>{
  const email = document.getElementById('email').value.trim();
  const license = document.getElementById('license').value.trim();
  const notion_secret = document.getElementById('secret').value.trim();
  const db_id = document.getElementById('db').value.trim();
  const bio_db_id = document.getElementById('bio').value.trim();
  const msg = document.getElementById('msg'); msg.style.display="block"; msg.textContent="Generando...";
  const r = await fetch('/api/activate',{method:'POST',headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ email, license, notion_secret, db_id, bio_db_id: bio_db_id||null })
  });
  const j = await r.json();
  if(!j.ok){ msg.textContent = "Error: "+(j.error||""); return; }
  msg.innerHTML = `<b>Widget URL:</b><br><a href="${j.widgetUrl}" target="_blank">${j.widgetUrl}</a><br><br>
  <b>Cómo usarlo:</b> Copia ese URL y haz <i>Embed</i> en tu Notion.`;
};
</script>
</body>
</html>
